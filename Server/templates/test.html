<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Mini App Test FIX</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background: #1a1a1a;
            color: white;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            color: #8774e1;
            margin-bottom: 20px;
        }

        .card {
            background: #2d2d2d;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .card.success {
            border-left: 5px solid #4CAF50;
        }

        .card.warning {
            border-left: 5px solid #ff9800;
        }

        .card.error {
            border-left: 5px solid #f44336;
        }

        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            height: 300px;
            overflow-y: auto;
            margin: 15px 0;
            white-space: pre-wrap;
        }

        .button {
            background: #8774e1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }

        .button:hover {
            opacity: 0.9;
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .methods {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .method-btn {
            background: #3a3a3a;
        }

        .method-btn.active {
            background: #8774e1;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>üõ†Ô∏è –¢–µ—Å—Ç Mini App —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –¥–ª—è Chrome</h1>

    <div id="statusCard" class="card">
        <h3 id="statusTitle">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</h3>
        <p id="statusText">–û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –∏ –±—Ä–∞—É–∑–µ—Ä...</p>
    </div>

    <div class="card">
        <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ</h3>
        <p><strong>–ë—Ä–∞—É–∑–µ—Ä:</strong> <span id="browserInfo">-</span></p>
        <p><strong>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</strong> <span id="platformInfo">-</span> (<span id="platformType">-</span>)</p>
        <p><strong>Telegram WebApp –≤–µ—Ä—Å–∏—è:</strong> <span id="versionInfo">-</span></p>
        <p><strong>–†–µ–∂–∏–º:</strong> <span id="modeInfo">-</span></p>
    </div>

    <div class="card warning">
        <h3>‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å Chrome</h3>
        <p>–í –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–π –≤–µ—Ä—Å–∏–∏ Telegram Web (–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ "web") –º–µ—Ç–æ–¥ sendData() –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.</p>
        <p><strong>–†–µ—à–µ–Ω–∏–µ:</strong> –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö.</p>
    </div>

    <div class="card">
        <h3>–ú–µ—Ç–æ–¥—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h3>
        <div class="methods">
            <button id="method1" class="button method-btn active" onclick="selectMethod(1)">–ú–µ—Ç–æ–¥ 1: sendData()</button>
            <button id="method2" class="button method-btn" onclick="selectMethod(2)">–ú–µ—Ç–æ–¥ 2: postMessage</button>
            <button id="method3" class="button method-btn" onclick="selectMethod(3)">–ú–µ—Ç–æ–¥ 3: iframe</button>
            <button id="method4" class="button method-btn" onclick="selectMethod(4)">–ú–µ—Ç–æ–¥ 4: fetch + initData</button>
        </div>

        <button id="sendBtn" class="button" style="background: #4CAF50; padding: 15px 30px; font-size: 16px;"
                onclick="sendData()">
            üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –º–µ—Ç–æ–¥–æ–º
        </button>

        <button id="debugBtn" class="button" style="background: #2196F3;" onclick="debugInfo()">
            üîç –û—Ç–ª–∞–¥–∫–∞ initData
        </button>
    </div>

    <div class="card">
        <h3>–õ–æ–≥–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏</h3>
        <div id="log" class="log">[–õ–æ–≥–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å]</div>
        <button class="button" onclick="clearLog()" style="background: #f44336;">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
    </div>

    <div class="card">
        <h3>–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã</h3>
        <p><strong>–ü—Ä–æ–±–ª–µ–º–∞:</strong> –í Chrome/Telegram Web (–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ "web") sendData() –Ω–µ –≤—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç update —É
            –±–æ—Ç–∞.</p>
        <p><strong>–ü—Ä–∏—á–∏–Ω–∞:</strong> –î–µ—Å–∫—Ç–æ–ø–Ω—ã–π Telegram Web –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥—Ä—É–≥–æ–π –º–µ—Ö–∞–Ω–∏–∑–º —Å–≤—è–∑–∏ –º–µ–∂–¥—É iframe –∏
            —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º –æ–∫–Ω–æ–º.</p>
        <p><strong>–†–µ—à–µ–Ω–∏–µ:</strong> –ù—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å postMessage API –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä –±–æ—Ç–∞
            –Ω–∞–ø—Ä—è–º—É—é.</p>
    </div>
</div>

<script>
    let telegram = null;
    let selectedMethod = 1;
    let logs = [];

    function log(msg, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${msg}`;
        logs.push(logEntry);

        const logDiv = document.getElementById('log');
        logDiv.innerHTML = logs.join('\n') + '\n' + logDiv.innerHTML;

        console.log(`[${type}]`, msg);
    }

    function clearLog() {
        logs = [];
        document.getElementById('log').innerHTML = '[–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã]';
    }

    function updateStatus(title, text, type = 'info') {
        const card = document.getElementById('statusCard');
        const titleEl = document.getElementById('statusTitle');
        const textEl = document.getElementById('statusText');

        titleEl.textContent = title;
        textEl.textContent = text;

        card.className = 'card';
        if (type === 'success') card.classList.add('success');
        if (type === 'warning') card.classList.add('warning');
        if (type === 'error') card.classList.add('error');
    }

    function selectMethod(method) {
        selectedMethod = method;

        // –°–±—Ä–æ—Å –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
        for (let i = 1; i <= 4; i++) {
            document.getElementById(`method${i}`).classList.remove('active');
        }

        // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π
        document.getElementById(`method${method}`).classList.add('active');

        const methods = {
            1: 'sendData() - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –º–µ—Ç–æ–¥ Telegram WebApp',
            2: 'postMessage - –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–∫–Ω–∞',
            3: 'iframe - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä—ã—Ç–æ–≥–æ iframe',
            4: 'fetch - –ø—Ä—è–º–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –±–æ—Ç–∞'
        };

        log(`–í—ã–±—Ä–∞–Ω –º–µ—Ç–æ–¥ ${method}: ${methods[method]}`);
    }

    function debugInfo() {
        if (!telegram) {
            log('Telegram WebApp –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
            return;
        }

        log('=== –î–ï–ë–ê–ì –ò–ù–§–û–†–ú–ê–¶–ò–Ø ===', 'debug');
        log(`initData: ${telegram.initData ? '–ï–°–¢–¨ (' + telegram.initData.length + ' chars)' : '–ù–ï–¢'}`, 'debug');
        log(`initDataUnsafe: ${JSON.stringify(telegram.initDataUnsafe, null, 2)}`, 'debug');
        log(`Platform: ${telegram.platform}`, 'debug');
        log(`Version: ${telegram.version}`, 'debug');
        log(`ColorScheme: ${telegram.colorScheme}`, 'debug');
        log(`–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ console.log`, 'debug');

        console.log('=== TELEGRAM WEBAPP DEBUG ===');
        console.log('Full Telegram.WebApp object:', telegram);
        console.log('initData:', telegram.initData);
        console.log('initDataUnsafe:', telegram.initDataUnsafe);
        console.log('Platform:', telegram.platform);
        console.log('UserAgent:', navigator.userAgent);
        console.log('URL hash:', window.location.hash.substring(0, 100) + '...');
    }

    function sendData() {
        if (!telegram) {
            updateStatus('–û—à–∏–±–∫–∞', 'Telegram WebApp –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
            return;
        }

        const data = {
            command: 'test',
            message: 'OK from Mini App',
            timestamp: Date.now(),
            platform: telegram.platform,
            method: selectedMethod,
            test_id: Math.random().toString(36).substring(7)
        };

        log(`–ù–∞—á–∏–Ω–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É –º–µ—Ç–æ–¥–æ–º ${selectedMethod}...`, 'info');
        updateStatus('–û—Ç–ø—Ä–∞–≤–∫–∞...', '–ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ...', 'warning');

        switch (selectedMethod) {
            case 1:
                sendViaTelegramAPI(data);
                break;
            case 2:
                sendViaPostMessage(data);
                break;
            case 3:
                sendViaIframe(data);
                break;
            case 4:
                sendViaFetch(data);
                break;
        }
    }

    // –ú–µ—Ç–æ–¥ 1: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Telegram WebApp API
    function sendViaTelegramAPI(data) {
        try {
            log('–ò—Å–ø–æ–ª—å–∑—É–µ–º telegram.sendData()...', 'info');
            telegram.sendData(JSON.stringify(data));
            log('‚úÖ sendData() –≤—ã–∑–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
            updateStatus('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ', '–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ Telegram API', 'success');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
            setTimeout(() => {
                telegram.showPopup({
                    title: '–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã',
                    message: '–ú–µ—Ç–æ–¥: sendData()\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –ø–æ–ª—É—á–∏–ª –ª–∏ –±–æ—Ç update.',
                    buttons: [{type: 'default', text: 'OK'}]
                });
            }, 500);

        } catch (error) {
            log(`‚ùå –û—à–∏–±–∫–∞ sendData(): ${error.message}`, 'error');
            updateStatus('–û—à–∏–±–∫–∞', `sendData() –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: ${error.message}`, 'error');
        }
    }

    // –ú–µ—Ç–æ–¥ 2: postMessage —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º—É –æ–∫–Ω—É
    function sendViaPostMessage(data) {
        try {
            log('–ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ postMessage...', 'info');

            // –≠—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è Telegram Web
            const message = {
                eventType: 'web_app_data',
                eventData: JSON.stringify(data)
            };

            // –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞–∑–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏
            if (window.parent && window.parent !== window) {
                window.parent.postMessage(message, '*');
                log('‚úÖ postMessage –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ window.parent', 'success');
            }

            if (window.top && window.top !== window) {
                window.top.postMessage(message, '*');
                log('‚úÖ postMessage –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ window.top', 'success');
            }

            // –¢–∞–∫–∂–µ –ø—Ä–æ–±—É–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ TelegramWebviewProxy (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
            if (typeof window.TelegramWebviewProxy !== 'undefined') {
                window.TelegramWebviewProxy.postEvent('web_app_data', JSON.stringify(data));
                log('‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω TelegramWebviewProxy', 'success');
            }

            updateStatus('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ', '–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ postMessage', 'success');

            telegram.showPopup({
                title: 'PostMessage –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω',
                message: '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ CORS.',
                buttons: [{type: 'default', text: 'OK'}]
            });

        } catch (error) {
            log(`‚ùå –û—à–∏–±–∫–∞ postMessage: ${error.message}`, 'error');
            updateStatus('–û—à–∏–±–∫–∞', `postMessage –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: ${error.message}`, 'error');
        }
    }

    // –ú–µ—Ç–æ–¥ 3: –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä—ã—Ç–æ–≥–æ iframe
    function sendViaIframe(data) {
        try {
            log('–°–æ–∑–¥–∞–µ–º —Å–∫—Ä—ã—Ç—ã–π iframe –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏...', 'info');

            // –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ —Å–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ iframe
            // –∫–æ—Ç–æ—Ä—ã–π –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π URL —Å –¥–∞–Ω–Ω—ã–º–∏
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.style.width = '0';
            iframe.style.height = '0';
            iframe.style.border = '0';

            // –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å endpoint –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –±–æ—Ç–∞
            // const url = `https://–≤–∞—à-—Å–µ—Ä–≤–µ—Ä.com/webhook?data=${encodeURIComponent(JSON.stringify(data))}`;
            // iframe.src = url;

            // –î–ª—è —Ç–µ—Å—Ç–∞ –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º about:blank
            iframe.src = 'about:blank';

            document.body.appendChild(iframe);

            setTimeout(() => {
                document.body.removeChild(iframe);
                log('‚úÖ Iframe —Å–æ–∑–¥–∞–Ω –∏ —É–¥–∞–ª–µ–Ω', 'success');
            }, 1000);

            updateStatus('Iframe —Å–æ–∑–¥–∞–Ω', '–ú–µ—Ç–æ–¥ iframe –≤—ã–ø–æ–ª–Ω–µ–Ω (—Ç—Ä–µ–±—É–µ—Ç —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —á–∞—Å—Ç–∏)', 'warning');

            telegram.showPopup({
                title: 'Iframe –º–µ—Ç–æ–¥',
                message: '–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ endpoint. –î–∞–Ω–Ω—ã–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã.',
                buttons: [{type: 'default', text: 'OK'}]
            });

        } catch (error) {
            log(`‚ùå –û—à–∏–±–∫–∞ iframe: ${error.message}`, 'error');
        }
    }

    // –ú–µ—Ç–æ–¥ 4: –ü—Ä—è–º–æ–π fetch –Ω–∞ —Å–µ—Ä–≤–µ—Ä –±–æ—Ç–∞
    function sendViaFetch(data) {
        // –í–ê–ñ–ù–û: –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CORS –Ω–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ
        // –∏ endpoint –¥–ª—è –ø—Ä–∏–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

        log('‚ö†Ô∏è –ú–µ—Ç–æ–¥ fetch —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞', 'warning');

        // –ü—Ä–∏–º–µ—Ä URL –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à)
        const botWebhookUrl = 'https://–≤–∞—à-–¥–æ–º–µ–Ω.com/webhook/mini-app';

        // –î–æ–±–∞–≤–ª—è–µ–º initData –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        data.initData = telegram.initData;
        data.initDataUnsafe = telegram.initDataUnsafe;

        updateStatus('–¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞', '–£–∫–∞–∂–∏—Ç–µ URL –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ –∫–æ–¥–µ', 'warning');

        telegram.showPopup({
            title: '–ú–µ—Ç–æ–¥ fetch',
            message: '–¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—É—é —á–∞—Å—Ç—å:\n1. –°–æ–∑–¥–∞—Ç—å endpoint\n2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CORS\n3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å initData\n\n–°–º–æ—Ç—Ä–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ –∫–æ–¥–µ.',
            buttons: [{type: 'default', text: 'OK'}]
        });

        // –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
        /*
        fetch(botWebhookUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(result => {
            log(`‚úÖ –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞: ${JSON.stringify(result)}`, 'success');
                updateStatus('–£—Å–ø–µ—à–Ω–æ', '–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ fetch', 'success');
            })
            .catch(error => {
                log(`‚ùå –û—à–∏–±–∫–∞ fetch: ${error.message}`, 'error');
                updateStatus('–û—à–∏–±–∫–∞', `Fetch –Ω–µ —É–¥–∞–ª—Å—è: ${error.message}`, 'error');
            });
            */
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', function () {
        log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'info');

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±—Ä–∞—É–∑–µ—Ä
        const ua = navigator.userAgent;
        let browser = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        if (ua.includes('YaBrowser')) browser = '–Ø–Ω–¥–µ–∫—Å.–ë—Ä–∞—É–∑–µ—Ä';
        else if (ua.includes('Chrome')) browser = 'Chrome';
        else if (ua.includes('Firefox')) browser = 'Firefox';
        else if (ua.includes('Safari')) browser = 'Safari';

        document.getElementById('browserInfo').textContent = browser;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º Telegram WebApp
        if (window.Telegram && window.Telegram.WebApp) {
            telegram = window.Telegram.WebApp;

            document.getElementById('platformInfo').textContent = telegram.platform;
            document.getElementById('versionInfo').textContent = telegram.version;

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
            let platformType = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            let mode = '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π';

            if (telegram.platform === 'web') {
                platformType = '–î–µ—Å–∫—Ç–æ–ø–Ω—ã–π Telegram Web';
                mode = '–ü–†–û–ë–õ–ï–ú–ù–´–ô - sendData() –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å';
                document.getElementById('statusCard').classList.add('warning');
            } else if (telegram.platform === 'weba') {
                platformType = '–í–µ–±-–≤–µ—Ä—Å–∏—è (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è)';
                mode = '–†–∞–±–æ—á–∏–π - –Ø–Ω–¥–µ–∫—Å.–ë—Ä–∞—É–∑–µ—Ä';
            } else if (telegram.platform === 'android' || telegram.platform === 'ios') {
                platformType = '–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ';
                mode = '–†–∞–±–æ—á–∏–π';
            } else if (telegram.platform === 'tdesktop') {
                platformType = '–î–µ—Å–∫—Ç–æ–ø–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ';
                mode = '–†–∞–±–æ—á–∏–π';
            }

            document.getElementById('platformType').textContent = platformType;
            document.getElementById('modeInfo').textContent = mode;

            log(`Telegram WebApp –æ–±–Ω–∞—Ä—É–∂–µ–Ω. –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ${telegram.platform} (${platformType})`, 'success');
            updateStatus('–ì–æ—Ç–æ–≤–æ', `–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ${telegram.platform}. ${mode}`, 'success');

            // –†–∞—Å—à–∏—Ä—è–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            telegram.ready();
            telegram.expand();

            // –î–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã 'web' —Å—Ä–∞–∑—É –≤—ã–±–∏—Ä–∞–µ–º –º–µ—Ç–æ–¥ 2
            if (telegram.platform === 'web') {
                selectMethod(2);
                log('‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ "web". –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ 2 (postMessage)', 'warning');
            }

        } else {
            log('Telegram WebApp –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω', 'error');
            updateStatus('–û—à–∏–±–∫–∞', '–ó–∞–ø—É—Å—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram', 'error');
            document.getElementById('sendBtn').disabled = true;
        }

        // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–∫–Ω–∞
        window.addEventListener('message', function (event) {
            log(`–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—è: ${JSON.stringify(event.data)}`, 'debug');
        });
    });
</script>
</body>
</html>